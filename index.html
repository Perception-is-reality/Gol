<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>InsightReads</title>

    <!-- math.js (hesap makinesi i√ßin) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.12.0/math.min.js"></script>

    <style>
        /* ---------- Temel Stil ---------- */
        :root {
            --accent: #DC2626;
            --accent-2: #2563EB;
            --card-bg: #fff;
            --muted: #555;
        }

        body { margin: 0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #f5f5f5; color: #333; transition: background .25s, color .25s; }
        body.dark { background: #121212; color: #e8e8e8; }

        header {
            display:flex; align-items:center; gap:12px;
            justify-content:space-between;
            position:fixed; top:0; left:0; right:0;
            background:var(--card-bg); border-bottom:1px solid #e6e6e6;
            padding:12px 16px; z-index:1000;
        }
        body.dark header { background: #1e1e1e; border-color: #333; }

        .logo { display:flex; align-items:center; gap:10px; cursor:pointer; }
        .logo img{ height:32px; width:auto; }
        .logo .title { font-weight:700; color:var(--accent); font-size:1.15rem; }

        .search-box { flex:1; max-width:480px; margin:0 12px; }
        .search-box input { width:100%; padding:8px 12px; border-radius:8px; border:1px solid #ccc; font-size:0.95rem; box-sizing:border-box; }
        body.dark .search-box input { background:#222; border-color:#444; color:#eee; }

        .menu-btn { font-size:20px; background:none; border:none; cursor:pointer; }

        /* Sidebar menu */
        nav {
            position:fixed; right:-280px; top:0; height:100vh; width:280px;
            background:var(--card-bg); box-shadow:-6px 0 30px rgba(0,0,0,0.08);
            padding-top:64px; transition:right .28s ease; z-index:999;
        }
        body.dark nav { background:#1e1e1e; }
        nav.show { right:0; }
        nav a { display:block; padding:14px 18px; color:inherit; text-decoration:none; border-bottom:1px solid #eee; }
        body.dark nav a { border-color:#333; }
        nav a:hover{ background:#fafafa; }
        body.dark nav a:hover{ background:#2a2a2a; }

        .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.28); display:none; z-index:998; }
        .overlay.show { display:block; }

        main { padding:84px 18px 28px; min-height:calc(100vh - 84px); box-sizing:border-box; }

        /* Home content - empty per request (no welcome message) */
        .home-empty { max-width:900px; margin:0 auto; min-height:240px; display:flex; align-items:center; justify-content:center; border-radius:12px; }

        /* Tools grid */
        .tools-container { max-width:980px; margin:0 auto; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:18px; }
        .tool-card { background:var(--card-bg); padding:18px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); text-align:center; cursor:pointer; transition:transform .15s, box-shadow .15s; }
        .tool-card:hover { transform:translateY(-6px); box-shadow:0 10px 26px rgba(0,0,0,0.08); }
        body.dark .tool-card { background:#1b1b1b; }

        /* Settings */
        .settings-container { max-width:640px; margin:0 auto; background:var(--card-bg); padding:18px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        body.dark .settings-container { background:#1b1b1b; }
        .settings-item { margin-bottom:12px; }
        .settings-item label{ display:block; margin-bottom:6px; font-weight:600; }
        .settings-item select, .settings-item button { padding:8px 10px; border-radius:8px; border:1px solid #ccc; background:transparent; cursor:pointer; }
        body.dark .settings-item select, body.dark .settings-item button { background:#232323; border-color:#333; color:#eee; }

        /* Notes */
        .notes-container { max-width:900px; margin:0 auto; background:var(--card-bg); padding:18px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        body.dark .notes-container { background:#1b1b1b; }
        .note-input { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; margin-bottom:10px; }
        body.dark .note-input { background:#232323; border-color:#333; color:#eee; }
        .note-btn { background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
        .note-list{ margin-top:14px; display:flex; flex-direction:column; gap:10px; }
        .note-item{ display:flex; justify-content:space-between; gap:12px; padding:12px; border-radius:8px; background:#fafafa; align-items:flex-start; }
        body.dark .note-item { background:#232323; }
        .note-item .meta { max-width:78%; }
        .note-item strong{ display:block; margin-bottom:6px; }
        .note-actions { display:flex; gap:8px; align-items:center; }

        /* Calculator */
        .calculator-wrapper{ margin:0 auto; width:100%; max-width:520px; }
        .calc-container{ background:#333; color:#fff; padding:18px; border-radius:12px; box-shadow:0 8px 28px rgba(0,0,0,0.5); position:relative; }
        .calc-container h2{ text-align:center; margin:0 0 10px; }
        .display{ width:100%; height:54px; border-radius:8px; padding:10px; font-size:20px; text-align:right; border:none; color:#000; box-sizing:border-box; }
        .buttons{ display:grid; grid-template-columns:repeat(6,1fr); gap:8px; margin-top:10px; }
        .calc-container button{ padding:12px; border-radius:8px; border:none; cursor:pointer; background:#555; color:#fff; font-size:15px; }
        .operator{ background:#f97316; }
        .clear-btn{ background:#999; }
        .scientific{ background:#444; }
        .close-btn{ position:absolute; right:12px; top:12px; width:32px; height:32px; border-radius:50%; background:var(--accent); color:#fff; border:none; cursor:pointer; }

        /* Misc layout */
        .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
        .col { flex:1; min-width:120px; }

        /* Masal */
        .masal-container { max-width:860px; margin:0 auto; background:var(--card-bg); padding:18px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        .form-row { display:flex; gap:10px; flex-wrap:wrap; }
        .masal-input { padding:8px; border-radius:8px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
        .masal-btn { background:#ff69b4; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
        .masal-result { margin-top:12px; padding:12px; background:#fffafc; border-radius:8px; min-height:80px; white-space:pre-wrap; text-align:left; }

        /* Spinner */
        .spinner{ border:4px solid #f3f3f3; border-top:4px solid #ff69b4; border-radius:50%; width:30px; height:30px; animation:spin 1s linear infinite; display:none; margin:10px auto; }
        @keyframes spin { to { transform:rotate(360deg); } }

        /* Responsive tweaks */
        @media (max-width:640px){
            .buttons{ grid-template-columns:repeat(4,1fr); }
            nav { width:100%; right:-100%; }
            nav.show { right:0; }
        }
    </style>
</head>
<body onload="initApp()">
   <header>
        <div class="logo" onclick="loadContent('home')">
            <img src="logo.png" alt="logo">
            <div class="title">InsightReads</div>
        </div>

        <div class="search-box">
            <input id="searchInput" placeholder="Ara... (√∂rn: hesap, notlar, ayarlar)">
        </div>

        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    </header>

    <nav id="menu">
        <a href="#" onclick="loadContent('tools'); toggleMenu();">üìÇ Ara√ßlar</a>
        <a href="#" onclick="loadContent('notes'); toggleMenu();">üìù Notlarƒ±m</a>
        <a href="#" onclick="loadContent('settings'); toggleMenu();">‚öôÔ∏è Ayarlar</a>
        <a href="#" onclick="loadContent('masal'); toggleMenu();">‚úçÔ∏è Masal Yazma</a>
        <a href="#" onclick="alert('Dilek√ße mod√ºl√º yakƒ±nda...'); toggleMenu();">üìÑ Dilek√ße</a>
        <a href="#" onclick="alert('Yardƒ±m'); toggleMenu();">‚ùì Yardƒ±m</a>
    </nav>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <main id="main-content">
        <!-- Ana sayfa bo≈ü bƒ±rakƒ±ldƒ± per istek -->
        <div class="home-empty"></div>
    </main>

<script>
/* =========================
   GLOBAL VE BA≈ûLANGI√á
   ========================= */

const mainContent = document.getElementById('main-content');
let currentContent = '';
let displayEl = null; // hesap makinesi ekran referansƒ±

function initApp(){
    // Y√ºkl√º ayarlarƒ± uygula
    loadSettingsFromStorage();

    // Arama: Enter veya tam e≈üle≈üme ile
    const s = document.getElementById('searchInput');
    if(s){
        s.addEventListener('keypress', (e)=>{
            if(e.key === 'Enter') handleSearch(s.value.trim());
        });
    }

    // ESC ile men√ºy√º kapat
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { closeMenuIfOpen(); } });
}

function toggleMenu(){
    const menu = document.getElementById('menu');
    const overlay = document.getElementById('overlay');
    menu.classList.toggle('show');
    overlay.classList.toggle('show');
}

function closeMenuIfOpen(){
    const menu = document.getElementById('menu');
    const overlay = document.getElementById('overlay');
    if(menu.classList.contains('show')) { menu.classList.remove('show'); overlay.classList.remove('show'); }
}

/* =========================
   ARAMA ƒ∞≈ûLEYƒ∞Cƒ∞
   ========================= */
function handleSearch(query){
    if(!query) return;
    const q = query.toLowerCase();
    if(q.includes('hesap') || q.includes('calculator') || q.includes('calc')) loadContent('calculator');
    else if(q.includes('not') || q.includes('notes')) loadContent('notes');
    else if(q.includes('ayar') || q.includes('settings')) loadContent('settings');
    else if(q.includes('masal') || q.includes('story')) loadContent('masal');
    else if(q.includes('ara√ß') || q.includes('tools') || q.includes('arac')) loadContent('tools');
    else alert(`"${query}" i√ßin bir sonu√ß bulunamadƒ±. Deneyin: hesap, notlar, ayarlar, masal, ara√ßlar`);
    document.getElementById('searchInput').value = '';
}

/* =========================
   SAYFA YAPILARI & ROUTING
   ========================= */

function loadContent(name){
    if(name === currentContent) return;
    currentContent = name;
    mainContent.innerHTML = ''; // temizle

    if(name === 'home'){
        // Bo≈ü ana sayfa (isteƒüe g√∂re placeholder bƒ±rakƒ±lmadƒ±)
        const div = document.createElement('div');
        div.className = 'home-empty';
        mainContent.appendChild(div);
        return;
    }

    if(name === 'tools'){
        mainContent.innerHTML = getToolsHTML();
        return;
    }

    if(name === 'settings'){
        mainContent.innerHTML = getSettingsHTML();
        return;
    }

    if(name === 'notes'){
        mainContent.innerHTML = getNotesHTML();
        // renderNotes √ßaƒüƒ±r
        renderNotes();
        return;
    }

    if(name === 'calculator'){
        mainContent.innerHTML = '<div class="calculator-wrapper">' + getCalculatorHTML() + '</div>';
        // initialize after DOM placed
        setTimeout(()=> initializeCalculator(), 50);
        return;
    }

    if(name === 'masal'){
        mainContent.innerHTML = getMasalHTML();
        return;
    }

    // fallback
    mainContent.innerHTML = '<div style="max-width:900px;margin:0 auto;">Sayfa bulunamadƒ±.</div>';
}

/* ---------- PAGE HTML ---------- */

function getToolsHTML(){
    return `
    <div class="tools-container">
        <div class="tool-card" onclick="loadContent('calculator')">üî¢<br><strong>Hesap Makinesi</strong></div>
        <div class="tool-card" onclick="loadContent('masal')">‚úçÔ∏è<br><strong>Masal Yazma</strong></div>
        <div class="tool-card" onclick="loadContent('notes')">üìù<br><strong>Notlarƒ±m</strong></div>
        <div class="tool-card" onclick="loadContent('settings')">‚öôÔ∏è<br><strong>Ayarlar</strong></div>
        <div class="tool-card" onclick="alert('Dilek√ße mod√ºl√º yakƒ±nda')">üìÑ<br><strong>Dilek√ße Yaz</strong></div>
    </div>
    `;
}

function getSettingsHTML(){
    const savedLang = localStorage.getItem('language') || 'tr';
    const savedFont = localStorage.getItem('fontSize') || 'normal';
    const dark = localStorage.getItem('darkMode') === 'true';
    return `
    <div class="settings-container">
        <h3>Ayarlar</h3>

        <div class="settings-item">
            <label>Karanlƒ±k Mod</label>
            <button onclick="toggleDarkMode()">${dark ? 'Karanlƒ±k Modu Kapat' : 'Karanlƒ±k Moda Ge√ß'}</button>
        </div>

        <div class="settings-item">
            <label>Dil</label>
            <select onchange="changeLanguage(this.value)">
                <option value="tr" ${savedLang==='tr'?'selected':''}>T√ºrk√ße</option>
                <option value="en" ${savedLang==='en'?'selected':''}>English</option>
            </select>
        </div>

        <div class="settings-item">
            <label>Yazƒ± Boyutu</label>
            <select onchange="changeFontSize(this.value)">
                <option value="small" ${savedFont==='small'?'selected':''}>K√º√ß√ºk</option>
                <option value="normal" ${savedFont==='normal'?'selected':''}>Normal</option>
                <option value="large" ${savedFont==='large'?'selected':''}>B√ºy√ºk</option>
            </select>
        </div>
    </div>
    `;
}

function getNotesHTML(){
    return `
    <div class="notes-container">
        <h3>üìù Notlarƒ±m</h3>
        <input id="noteTitle" class="note-input" placeholder="Not ba≈ülƒ±ƒüƒ± (opsiyonel)">
        <textarea id="noteContent" class="note-input" placeholder="Not i√ßeriƒüini yaz..." rows="5"></textarea>
        <div style="display:flex; gap:10px; align-items:center;">
            <button class="note-btn" onclick="addNote()">Ekle</button>
            <input id="noteSearch" class="note-input" placeholder="Notlarda ara..." style="flex:1;" oninput="renderNotes()">
        </div>
        <div id="noteList" class="note-list"></div>
    </div>
    `;
}

/* ---------- Masal (Story) ---------- */
function getMasalHTML(){
    return `
    <div class="masal-container">
        <h3>üåü Masal √úretici</h3>
        <div class="form-row" style="margin-bottom:10px;">
            <input id="masalKahraman" class="masal-input" placeholder="Kahraman (√∂rn: Minik Ayƒ±)">
            <input id="masalYer" class="masal-input" placeholder="Yer (√∂rn: Orman)">
        </div>
        <div class="form-row" style="margin-bottom:10px;">
            <input id="masalKonu" class="masal-input" placeholder="Konu (√∂rn: Dostluk)">
            <input id="masalDuygu" class="masal-input" placeholder="Duygu (√∂rn: Ne≈üeli)">
        </div>
        <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
            <select id="masalYas" class="masal-input" style="width:200px;">
                <option value="2-3">2-3 Ya≈ü</option>
                <option value="3-4">3-4 Ya≈ü</option>
                <option value="5-6">5-6 Ya≈ü</option>
                <option value="okul-oncesi" selected>Okul √ñncesi</option>
            </select>
            <button class="masal-btn" id="masalUretBtn" onclick="uretMasal()">‚ú® Masal √úret ‚ú®</button>
            <div id="masalSpinner" class="spinner"></div>
        </div>
        <div id="masalSonuc" class="masal-result">Masalƒ±nƒ±z burada belirecek...</div>
        <div style="margin-top:12px;">
            <button onclick="saveMasalToNotes()">Masalƒ± Notlarƒ±ma Kaydet</button>
        </div>
    </div>
    `;
}

/* ---------- Calculator HTML ---------- */
function getCalculatorHTML(){
    return `
    <div class="calc-container">
        <button class="close-btn" onclick="loadContent('home')">X</button>
        <h2>Bilimsel Hesap Makinesi</h2>
        <input id="display" class="display" placeholder="0" readonly>
        <div class="buttons">
            <button class="scientific" onclick="appendCalc('PI')">œÄ</button>
            <button class="scientific" onclick="appendCalc('E')">e</button>
            <button class="scientific" onclick="appendCalc('log(')">lg</button>
            <button class="scientific" onclick="appendCalc('log10(')">log</button>
            <button class="scientific" onclick="appendCalc('!')">n!</button>
            <button class="operator" onclick="calculatePercentage()">%</button>

            <button onclick="appendCalc('7')">7</button>
            <button onclick="appendCalc('8')">8</button>
            <button onclick="appendCalc('9')">9</button>
            <button class="operator" onclick="appendCalc('/')">/</button>
            <button class="operator" onclick="appendCalc('sqrt(')">‚àö</button>
            <button class="scientific" onclick="appendCalc('^')">x^y</button>

            <button onclick="appendCalc('4')">4</button>
            <button onclick="appendCalc('5')">5</button>
            <button onclick="appendCalc('6')">6</button>
            <button class="operator" onclick="appendCalc('*')">*</button>
            <button class="operator" onclick="appendCalc('(')">(</button>
            <button class="operator" onclick="appendCalc(')')">)</button>

            <button onclick="appendCalc('1')">1</button>
            <button onclick="appendCalc('2')">2</button>
            <button onclick="appendCalc('3')">3</button>
            <button class="operator" onclick="appendCalc('-')">-</button>
            <button class="scientific" onclick="appendCalc('sin(')">sin</button>
            <button class="scientific" onclick="appendCalc('cos(')">cos</button>

            <button onclick="appendCalc('0')">0</button>
            <button onclick="appendCalc('.')">.</button>
            <button class="operator" onclick="evaluateCalc()" style="grid-column:span 2;">=</button>
            <button class="operator" onclick="appendCalc('+')">+</button>
            <button class="scientific" onclick="appendCalc('tan(')">tan</button>
            <button class="clear-btn" onclick="clearCalc()">C</button>
        </div>

        <hr style="border-color:#555; margin:14px 0;">

        <h3 style="color:#fff; margin:0 0 8px 0;">Ohm Kanunu</h3>
        <select id="calculateFor" style="margin-bottom:8px;">
            <option value="V">Gerilim (V)</option>
            <option value="I">Akƒ±m (I)</option>
            <option value="R">Diren√ß (R)</option>
        </select>
        <div class="row ohm-inputs">
            <input type="number" id="value1" placeholder="Birinci deƒüer">
            <input type="number" id="value2" placeholder="ƒ∞kinci deƒüer">
            <button onclick="calculateOhm()">Hesapla</button>
        </div>
        <div id="result" class="result"></div>

        <hr style="border-color:#555; margin:14px 0;">

        <h3 style="color:#fff; margin:0 0 8px 0;">Form√ºller</h3>
        <select id="formulaSelect" onchange="selectFormula()">
            <option value="">Form√ºl Se√ß</option>
            <option value="areaSquare">Kare Alanƒ± a¬≤</option>
            <option value="areaRectangle">Dikd√∂rtgen a*b</option>
            <option value="areaCircle">Daire œÄ r¬≤</option>
            <option value="volumeCube">K√ºp a¬≥</option>
            <option value="volumeCylinder">Silindir œÄ r¬≤ h</option>
            <option value="kineticEnergy">Kinetik Enerji 0.5 m v¬≤</option>
            <option value="potentialEnergy">Potansiyel Enerji m g h</option>
        </select>
        <div id="formulaInputs" style="margin-top:8px;"></div>
        <button onclick="calculateFormula()" style="margin-top:8px;">Hesapla</button>
        <div id="formulaResult" class="result"></div>

        <hr style="border-color:#555; margin:14px 0;">

        <h3 style="color:#fff; margin:0 0 8px 0;">Birim D√∂n√º≈üt√ºr√ºc√º</h3>
        <select id="unitType" onchange="updateUnits()">
            <option value="">Birim Tipi</option>
            <option value="length">Uzunluk</option>
            <option value="weight">Aƒüƒ±rlƒ±k</option>
            <option value="temperature">Sƒ±caklƒ±k</option>
            <option value="volume">Hacim</option>
        </select>
        <div class="row" style="margin-top:8px;">
            <input type="number" id="unitValue" placeholder="Deƒüer Girin">
            <select id="unitFrom"></select>
            <select id="unitTo"></select>
            <button onclick="convertUnit()">D√∂n√º≈üt√ºr</button>
        </div>
        <div id="unitResult" class="result"></div>
    </div>
    `;
}

/* =========================
   HESAP MAKƒ∞NESƒ∞ FONKSƒ∞YONLARI
   ========================= */

/* Geli≈ümi≈ü fakt√∂riyel desteƒüi:
   Hem "5!" hem "(2+3)!" gibi durumlarƒ± mathjs factorial(...) ≈üeklinde √ßevirir.
*/
function initializeCalculator(){
    displayEl = document.getElementById('display');
    updateUnits(); // birim dropdownlarƒ±nƒ± g√ºncelle
}

function appendCalc(val){
    if(!displayEl) return;
    // basit g√ºvenlik: gereksiz uzunluk engelle
    if(displayEl.value.length > 500) return;
    displayEl.value += val;
}

function clearCalc(){
    if(!displayEl) return;
    displayEl.value = '';
}

function evaluateCalc(){
    try{
        if(!displayEl) return;
        let expr = displayEl.value;
        // ln -> natural log, log -> log10 handling (keep both)
        expr = expr.replace(/\bln\(/g, 'log(');
        // convert occurrences like "(...)" or number followed by ! into factorial(...)
        expr = expr.replace(/(\([^()]+\)|\d+)!/g, 'factorial($1)');
        // handle percent signs simply: replace % by /100
        expr = expr.replace(/%/g, '/100');
        const res = math.evaluate(expr);
        displayEl.value = (typeof res === 'number' || typeof res === 'string') ? res.toString() : JSON.stringify(res);
    }catch(err){
        displayEl.value = 'Hata';
    }
}

function calculatePercentage(){
    try{
        if(!displayEl) return;
        let expr = displayEl.value.replace(/%/g, '/100');
        expr = expr.replace(/(\([^()]+\)|\d+)!/g, 'factorial($1)');
        displayEl.value = math.evaluate(expr);
    }catch(e){
        displayEl.value = 'Hata';
    }
}

/* Ohm, Form√ºler, Unit converter */

const units = {
    length:{ m:1, cm:0.01, km:1000, inch:0.0254, mile:1609.34 },
    weight:{ kg:1, g:0.001, lb:0.453592, ton:1000 },
    volume:{ L:1, mL:0.001, m3:1000, gallon:3.78541 }
};

function calculateOhm(){
    const calcFor = document.getElementById('calculateFor').value;
    const v1 = parseFloat(document.getElementById('value1').value);
    const v2 = parseFloat(document.getElementById('value2').value);
    const resEl = document.getElementById('result');
    if(isNaN(v1) || isNaN(v2)){ resEl.innerText = 'L√ºtfen ge√ßerli deƒüer girin!'; return; }
    let r;
    switch(calcFor){
        case 'V': r = v1 * v2; resEl.innerText = `Gerilim V = ${r.toFixed(4)} V`; break;
        case 'I': if(v2===0){ resEl.innerText='Diren√ß 0 olamaz!'; return;} r = v1 / v2; resEl.innerText = `Akƒ±m I = ${r.toFixed(4)} A`; break;
        case 'R': if(v2===0){ resEl.innerText='Akƒ±m 0 olamaz!'; return;} r = v1 / v2; resEl.innerText = `Diren√ß R = ${r.toFixed(4)} Œ©`; break;
    }
}

function selectFormula(){
    const f = document.getElementById('formulaSelect').value;
    const container = document.getElementById('formulaInputs');
    container.innerHTML = '';
    switch(f){
        case 'areaSquare': container.innerHTML = '<input id="a" type="number" placeholder="Kenar a">'; break;
        case 'areaRectangle': container.innerHTML = '<input id="a" type="number" placeholder="Kenar a"><input id="b" type="number" placeholder="Kenar b">'; break;
        case 'areaCircle': container.innerHTML = '<input id="r" type="number" placeholder="Yarƒ±√ßap r">'; break;
        case 'volumeCube': container.innerHTML = '<input id="a" type="number" placeholder="Kenar a">'; break;
        case 'volumeCylinder': container.innerHTML = '<input id="r" type="number" placeholder="Yarƒ±√ßap r"><input id="h" type="number" placeholder="Y√ºkseklik h">'; break;
        case 'kineticEnergy': container.innerHTML = '<input id="m" type="number" placeholder="K√ºtle m (kg)"><input id="v" type="number" placeholder="Hƒ±z v (m/s)">'; break;
        case 'potentialEnergy': container.innerHTML = '<input id="m" type="number" placeholder="K√ºtle m (kg)"><input id="h" type="number" placeholder="Y√ºkseklik h (m)">'; break;
    }
}

function calculateFormula(){
    const f = document.getElementById('formulaSelect').value;
    const out = document.getElementById('formulaResult');
    const val = id => parseFloat(document.getElementById(id)?.value);
    let res;
    switch(f){
        case 'areaSquare': res = Math.pow(val('a'),2); break;
        case 'areaRectangle': res = val('a') * val('b'); break;
        case 'areaCircle': res = Math.PI * Math.pow(val('r'),2); break;
        case 'volumeCube': res = Math.pow(val('a'),3); break;
        case 'volumeCylinder': res = Math.PI * Math.pow(val('r'),2) * val('h'); break;
        case 'kineticEnergy': res = 0.5 * val('m') * Math.pow(val('v'),2); break;
        case 'potentialEnergy': res = val('m') * 9.81 * val('h'); break;
        default: out.innerText = 'L√ºtfen bir form√ºl se√ßin.'; return;
    }
    if(isNaN(res)) out.innerText = 'L√ºtfen t√ºm deƒüerleri girin.'; else out.innerText = 'Sonu√ß: ' + res.toFixed(4);
}

function updateUnits(){
    const type = document.getElementById('unitType').value;
    const from = document.getElementById('unitFrom');
    const to = document.getElementById('unitTo');
    if(!from || !to) return;
    from.innerHTML = ''; to.innerHTML = '';
    if(type === 'temperature'){
        ['C','F','K'].forEach(u => { from.innerHTML += `<option value="${u}">${u}</option>`; to.innerHTML += `<option value="${u}">${u}</option>`; });
        return;
    }
    if(units[type]){
        Object.keys(units[type]).forEach(u => { from.innerHTML += `<option value="${u}">${u}</option>`; to.innerHTML += `<option value="${u}">${u}</option>`; });
    }
}

function convertUnit(){
    const type = document.getElementById('unitType').value;
    let val = parseFloat(document.getElementById('unitValue').value);
    const from = document.getElementById('unitFrom').value;
    const to = document.getElementById('unitTo').value;
    const out = document.getElementById('unitResult');
    if(isNaN(val)){ out.innerText = 'L√ºtfen bir deƒüer girin!'; return; }
    let result;
    if(type === 'temperature'){
        if(from==='C'){ result = to==='F'? val*9/5+32 : to==='K'? val+273.15 : val; }
        else if(from==='F'){ result = to==='C'? (val-32)*5/9 : to==='K'? (val-32)*5/9+273.15 : val; }
        else if(from==='K'){ result = to==='C'? val-273.15 : to==='F'? (val-273.15)*9/5+32 : val; }
    } else if(units[type]){
        result = val * units[type][from] / units[type][to];
    }
    if(result !== undefined) out.innerText = 'Sonu√ß: ' + result.toFixed(6);
    else out.innerText = 'Ge√ßersiz se√ßim.';
}

/* =========================
   NOTLAR (ID-BAZLI + XSS KORUMALI)
   ========================= */

/* HTML escape fonksiyonu ‚Äî kaydetmeden √∂nce kullan */
function escapeHTML(str){
    if(str === null || str === undefined) return '';
    return String(str).replace(/[&<>"']/g, function (m) {
      return ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;"
      })[m];
    });
}

function addNote(){
    const tEl = document.getElementById('noteTitle');
    const cEl = document.getElementById('noteContent');
    if(!tEl || !cEl) return;

    const rawTitle = tEl.value.trim();
    const rawContent = cEl.value.trim();
    if(rawTitle === '' && rawContent === '') return;

    // XSS korumasƒ±: saklamadan √∂nce ka√ßƒ±≈ü
    const title = escapeHTML(rawTitle);
    const content = escapeHTML(rawContent);

    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    notes.push({ id: Date.now(), title, content });
    localStorage.setItem('notes', JSON.stringify(notes));
    tEl.value = ''; cEl.value = '';
    renderNotes();
}

function renderNotes(){
    const listEl = document.getElementById('noteList');
    if(!listEl) return;
    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    const searchRaw = document.getElementById('noteSearch')?.value || '';
    const search = searchRaw.toLowerCase();

    const filtered = notes.filter(n => (n.title || '').toLowerCase().includes(search) || (n.content || '').toLowerCase().includes(search));
    if(filtered.length === 0){ listEl.innerHTML = '<div style="color:var(--muted)">Not bulunamadƒ±.</div>'; return; }

    // not.title / not.content zaten escape'lenmi≈ü olarak saklanƒ±yor -> g√ºvenle innerHTML ile koyuyoruz
    listEl.innerHTML = filtered.map(n => `
        <div class="note-item">
            <div class="meta">
                <strong>${n.title || 'Ba≈ülƒ±ksƒ±z'}</strong>
                <div>${n.content}</div>
                <div style="margin-top:8px; font-size:12px; color:var(--muted);">${new Date(n.id).toLocaleString()}</div>
            </div>
            <div class="note-actions">
                <button onclick="editNotePrompt(${n.id})">D√ºzenle</button>
                <button onclick="deleteNote(${n.id})" style="background:transparent;color:var(--accent);border:none;font-size:18px;cursor:pointer;">üóëÔ∏è</button>
            </div>
        </div>
    `).join('');
}

function deleteNote(id){
    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    const filtered = notes.filter(n => n.id !== id);
    localStorage.setItem('notes', JSON.stringify(filtered));
    renderNotes();
}

function editNotePrompt(id){
    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    const note = notes.find(n => n.id === id);
    if(!note) return;
    // decode for prompt display ‚Äî stored value is escaped HTML; we want plain text in prompt
    const decodedTitle = decodeHTML(note.title);
    const decodedContent = decodeHTML(note.content);

    const newTitleRaw = prompt('Ba≈ülƒ±k (iptal i√ßin "ƒ∞ptal" veya Esc):', decodedTitle);
    if(newTitleRaw === null) return; // iptal
    const newContentRaw = prompt('ƒ∞√ßerik (iptal i√ßin Esc):', decodedContent);
    if(newContentRaw === null) return;

    // saklamadan √∂nce escape
    note.title = escapeHTML(newTitleRaw.trim());
    note.content = escapeHTML(newContentRaw.trim());
    localStorage.setItem('notes', JSON.stringify(notes));
    renderNotes();
}

/* decode helper ‚Äî sadece prompt/editleme gibi kullanƒ±cƒ±ya geri g√∂sterirken kullanƒ±lƒ±r */
function decodeHTML(str){
    if(!str) return '';
    const txt = document.createElement('textarea');
    txt.innerHTML = str;
    return txt.value;
}

/* =========================
   MASAL √úRETƒ∞Cƒ∞ (Basit entegrasyon)
   ========================= */
const yasKurallari = {
    "2-3": { kelimeSiniri:40, ek:'2-3 kelimelik kƒ±sa c√ºmleler. Bol tekrar ve ses ekle.' },
    "3-4": { kelimeSiniri:70, ek:'Kƒ±sa c√ºmleler, basit kelimeler.' },
    "5-6": { kelimeSiniri:150, ek:'Biraz daha uzun c√ºmleler. Basit √∂ƒüretici bir ders olsun.' },
    "okul-oncesi": { kelimeSiniri:100, ek:'Sevimli ve sƒ±cak bir hikaye yaz.' }
};

function setMasalLoading(isLoading){
    const s = document.getElementById('masalSpinner');
    const btn = document.getElementById('masalUretBtn');
    if(!s || !btn) return;
    if(isLoading){ s.style.display='block'; btn.disabled=true; btn.innerText='√úretiliyor...'; document.getElementById('masalSonuc').innerText=''; }
    else{ s.style.display='none'; btn.disabled=false; btn.innerText='‚ú® Masal √úret ‚ú®'; }
}

async function uretMasal(){
    const kahramanRaw = (document.getElementById('masalKahraman')?.value || '').trim();
    const yerRaw = (document.getElementById('masalYer')?.value || '').trim();
    const konuRaw = (document.getElementById('masalKonu')?.value || 'Dostluk').trim();
    const duyguRaw = (document.getElementById('masalDuygu')?.value || 'Ne≈üeli').trim();
    const yas = document.getElementById('masalYas')?.value || 'okul-oncesi';
    const sonucEl = document.getElementById('masalSonuc');

    if(!kahramanRaw || !yerRaw){ sonucEl.innerText = 'L√ºtfen Kahraman ve Yer alanlarƒ±nƒ± doldurun.'; return; }

    setMasalLoading(true);
    const { kelimeSiniri, ek } = yasKurallari[yas];

    // Basit client-side fallback masal (backend yoksa): 
    try{
        const fallback = `${kahramanRaw} ${yerRaw}‚Äôde dola≈üƒ±rken k√º√ß√ºk bir sƒ±r ke≈üfetti. ${kahramanRaw} ve arkada≈ülarƒ± birlikte ${konuRaw.toLowerCase()} √∂ƒürendiler.`;
        await new Promise(r=>setTimeout(r,500));
        sonucEl.innerText = fallback;
    }catch(err){
        sonucEl.innerText = 'Masal √ºretimi sƒ±rasƒ±nda hata: ' + (err.message || err);
    }finally{
        setMasalLoading(false);
    }
}

// Masalƒ± Notlar'a kaydet (kaydederken escape)
function saveMasalToNotes(){
    const text = document.getElementById('masalSonuc')?.innerText || '';
    if(!text) { alert('Kaydetilecek bir masal yok'); return; }
    const notes = JSON.parse(localStorage.getItem('notes') || '[]');
    notes.push({ id: Date.now(), title: escapeHTML('Masal - ' + new Date().toLocaleString()), content: escapeHTML(text) });
    localStorage.setItem('notes', JSON.stringify(notes));
    alert('Masal Notlarƒ±nƒ±za kaydedildi');
}

/* =========================
   AYARLAR (localStorage)
   ========================= */

function toggleDarkMode(){
    const isDark = document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', isDark ? 'true' : 'false');
    if(currentContent === 'settings') loadContent('settings'); // buton label g√ºncelle
}

function changeLanguage(lang){
    localStorage.setItem('language', lang);
    alert('Dil kaydedildi: ' + (lang === 'tr' ? 'T√ºrk√ße' : 'English'));
}

function changeFontSize(size){
    if(size === 'small') document.documentElement.style.fontSize = '14px';
    else if(size === 'normal') document.documentElement.style.fontSize = '16px';
    else if(size === 'large') document.documentElement.style.fontSize = '18px';
    localStorage.setItem('fontSize', size);
}

function loadSettingsFromStorage(){
    if(localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark');
    const font = localStorage.getItem('fontSize') || 'normal';
    changeFontSize(font);
}

/* =========================
   EXPOSE & HELPERS
   ========================= */

function ensureMenuClosed(){ closeMenuIfOpen(); }

/* expose some functions to global for onclick binding in HTML strings */
window.loadContent = loadContent;
window.toggleMenu = toggleMenu;
window.handleSearch = handleSearch;
window.appendCalc = appendCalc;
window.clearCalc = clearCalc;
window.evaluateCalc = evaluateCalc;
window.calculatePercentage = calculatePercentage;
window.initializeCalculator = initializeCalculator;
window.updateUnits = updateUnits;
window.selectFormula = selectFormula;
window.calculateFormula = calculateFormula;
window.calculateOhm = calculateOhm;
window.convertUnit = convertUnit;
window.addNote = addNote;
window.renderNotes = renderNotes;
window.deleteNote = deleteNote;
window.editNotePrompt = editNotePrompt;
window.toggleDarkMode = toggleDarkMode;
window.changeLanguage = changeLanguage;
window.changeFontSize = changeFontSize;
window.uretMasal = uretMasal;
window.saveMasalToNotes = saveMasalToNotes;

/* initApp was called on body.onload */
</script>
</body>
</html>
